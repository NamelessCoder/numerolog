#!/usr/bin/env php
<?php

$paths = array(
	__DIR__ . '/../',
	__DIR__ . '/../../../../',
);
foreach ($paths as $index => $path) {
	$path = rtrim(realpath($path)) . '/';
	if (file_exists($path . 'vendor/autoload.php')) {
		define('NUMEROLOG_HOME', $path);
		break;
	}
	$paths[$index] = $path;
}

if (!defined('NUMEROLOG_HOME')) {
	echo 'Error! Numerolog could not detect your vendor dir. Did you install using composer install?. We checked:' . PHP_EOL;
	foreach ($paths as $path) {
		echo ' * ' . $path . PHP_EOL;
	}
	exit(2);
}

define('NUMEROLOG_DATABASE_BASEDIR', NUMEROLOG_HOME . 'data/');

require_once NUMEROLOG_HOME . 'vendor/autoload.php';

$composerFile = NUMEROLOG_HOME . 'composer.json';
if (!file_exists($composerFile)) {
	echo 'Error! Numerolog only functions inside projects with a composer.json file (containing a "name")' . PHP_EOL;
	exit(1);
}

$composer = json_decode(file_get_contents($composerFile), JSON_OBJECT_AS_ARRAY);
$client = new \NamelessCoder\Numerolog\Client();
$parameters = array_slice($argv, 1);
$query = new \NamelessCoder\Numerolog\Query($parameters);
echo json_encode($client->query($query)) . PHP_EOL;
